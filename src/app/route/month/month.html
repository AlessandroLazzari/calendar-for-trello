<ion-view title="Trello Calendar">
    <ion-nav-buttons side="right">
        <div ng-switch="login">
            <button class="button button-positive" ng-switch-default ng-click="auth()">Login</button>
            <button class="button button-positive" ng-click="refresh()"  ng-switch-when="true" ng-class="{animate: loading}"><i class="ion-refresh"></i></button>
            <button class="button button-assertive" ng-switch-when="true" ng-click="logout()">Logout</button>
        </div>
    </ion-nav-buttons>
    <ion-content class="padding " padding="true">
        <ion-refresher
                pulling-text="Pull to refresh..."
                on-refresh="refresh()"
                spinner="none"
                pulling-text=""
                >
        </ion-refresher>






        <div class="calNav">
            <h1>
                <div class="btn-group" role="group" aria-label="Month Navigation">
                    <button type="button" class="btn btn-default"  ng-click="move(-1)" >
                        <i class="ion-chevron-left"></i>
                    </button>
                    <button type="button" class="btn btn-default" ng-click="move(1)">
                        <i class="ion-chevron-right"></i>
                    </button>
                </div>
                {{date.monthName}}, {{date.year}}
                <button class="btn btn-default pull-right" ng-if="today" ng-click="toToday()">Today</button>
            </h1>
        </div>










        <div class="filters" ng-class="{'colorize' : boardColors, 'defaultColor' : !boardColors }">
            <ui-select multiple ng-model="multipleDemo.selectedBoards"  ng-disabled="disabled">
                <ui-select-match placeholder="Select board..."> <span class="inner" style="color:{{$item.color}}">{{$item.name}}</span></ui-select-match>
                <ui-select-choices repeat="board in boards">
                    <div ng-bind-html="board.name | highlight: $select.search" ></div>
                </ui-select-choices>
            </ui-select>
        </div>





        <div class="listView">
            <div class="day header" ng-repeat="wd in weekdays"><span class="short">{{wd[0]}}</span><span class="long">{{wd[1]}}</span></div>

            <div ng-repeat="day in days"
                 class="day"
                 ng-class="{'dayOff': day.dayOff, 'dayOn' : !day.dayOff, 'has' : day.cards.length >= 1, 'today' :day.isToday}"
                 ng-drop="true"
                 ng-drop-success="onDropComplete($data,$event, day.date)">


                <div class="dayCounter" ><span class="weekday">{{day.weekday}}</span><span>{{day.i}}</span></div>
                <div class="dayCards">
                    <div ng-repeat="card in day.cards | orderBy:['badges.due', 'name'] | filter: activeBoard"
                         ng-drag="true" ng-drag-data="card"
                         ng-drag-success="onDragSuccess($data,$event,day.date)"
                         ng-center-anchor="{{centerAnchor}}">




                        <div class="dayCard color{{card.colorCount}}"
                             ng-class="{waiting: card.waiting, 'stopColor' : !boardColors}"
                             style="background:{{card.color}}"
                                >
                            <div class="ion-arrow-move dragger"></div>
                            <div class="ion-help-circled dragger showDetail " ng-click="detail(card.id)"></div>
                            <div class="title" ><a ng-href="{{card.shortUrl}}" target="_blank"> {{card.name}}</a></div>
                            <div class="board"> <a ng-href="{{card.boardUrl}}" target="_blank"><span class="boardName">{{card.boardName}}</span></a>  | <span>{{card.badges.due | date : "HH:mm" : timezone}}</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>




        <div class="detail padding" ng-if="showDetail">
            <div class="detailOptions">
                <a class="" ng-href="{{singleCard.shortUrl}}" target="_blank"><span class="ion-android-open"></span></a>
                <span class="ion-close " ng-click="closeDetail()"></span>
            </div>


            <div class="row responsive-sm">
                <div class="col col-20"></div>
                <div class="col col-80"><h4><strong>   {{singleCard.name}}</strong></h4></div>
            </div>
            <div class="row responsive-sm">
                <div class="col col-20"><strong>Board:</strong></div>
                <div class="col col-80"><a ng-href="{{singleCard.boardUrl}}" target="_blank"> {{singleCard.boardName}}</a></div>
            </div>
            <div class="row responsive-sm">
                <div class="col col-20"><strong>Due date:</strong></div>
                <div class="col col-80">{{singleCard.dueDate| date:'dd.MM.yyyy  HH:mm'}}</div>
            </div>
            <div class="row responsive-sm">
                <div class="col col-20"><strong>Latest Activity:</strong></div>
                <div class="col col-80">{{singleCard.dateLastActivity| date:'dd.MM.yyyy  HH:mm'}}</div>
            </div>
            <div class="row responsive-sm" ng-if="singleCard.desc">
                <div class="col col-20"><strong>Description:</strong></div>
                <div class="col col-80">
                    <p>{{singleCard.desc}}</p>
                </div>
            </div>
            <div class="row responsive-sm">
                <div class="col col-20"><strong>Members:</strong></div>
                <div class="col col-80">
                    <p>... / ... / ... </p>
                </div>
            </div>

            <span ng-if="singleCards.badges.comments">Kommentare:   {{singleCard.badges.comments}}</span>
            <span ng-if="singleCards.badges.comments">Kommentare:   {{singleCard.comments}}</span>
        </div>
    </ion-content>
</ion-view>
